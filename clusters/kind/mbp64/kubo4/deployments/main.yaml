

gitRepositories:

  - name: kad-components
    watched: true
    interval: 30s
    ref:
      branch: sa-work1
    url: https://github.com/kubotal/kad-components.git
  - name: kad-data1
    interval: 30s
    url: https://github.com/SergeAlexandre/kad-data1.git
  - name: kad-data2
    interval: 30s
    url: https://github.com/SergeAlexandre/kad-data2.git

#   Replaced by flux-system/flux-system
#  - name: kad-infra-sa
#    url: ssh://git@github.com/kubotal/kad-infra-sa
#    ref:
#      branch: work1
#    secretRef: flux-system


loaders:
  - name: kad-components
    source:
      gitRepository:
        name: kad-components
    kadFiles:
      - components
      - templates
    rules:
      component: '^.*$'
      template: '^.*$'

  - name: kad-data1
    source:
      gitRepository:
        name: kad-data1
    kadFiles:
      - data
    rules:
      document: '^data1-.*$'

  - name: kad-data2
    source:
      gitRepository:
        name: kad-data2
    kadFiles:
      - data
    rules:
      document: '^data2-.*$'

  - name: context
    source:
      gitRepository:
        # name: kad-infra-sa
        name: flux-system
        namespace: flux-system
        unmanaged: true
    kadFiles:
      - clusters/context.yaml
      - clusters/kind/context.yaml
      - clusters/kind/mbp64/context.yaml
      - clusters/kind/mbp64/kubo4/context.yaml

templateReleases:

  - name: system-base
    template:
      name: system-base
      version: 1.0.0

  - name: tools
    template:
      name: tools
      version: 1.0.0
      parameters:
        reloader: true

  - name: minio1
    template:
      name: minio-1
      version: 1.0.0
      parameters:
        namespace: minio1
        capacityGb: 10
        ingressName: minio1
      parameterFiles:
        - document: data1-minio-parameters
          unwrap: minio
          wrap: admin

  - name: minio2
    template:
      name: minio-1
      version: 1.0.0
      parameters:
        namespace: minio2
        capacityGb: 10
        ingressName: minio2
        ldap: openldap
        dependsOn:
          - openldap
      parameterFiles:
        - document: data2-minio-parameters
          unwrap: minio
          wrap: admin


componentReleases:

  - name: kad-webserver
    enabled: true
    component:
      name: kad-webserver
      version: 1.0.0
      parameters:
        debug: true
    namespace: flux-system
    dependsOn:
      - ingress-nginx

  - name: cnpg
    namespace: cnpg
    component:
      name: cnpg
      version: 1.0.0


  - name: openldap
    enabled: true
    component:
      name: openldap
      version: 1.0.0
      parameters:
        ldapDomain: "odp.com"
        adminUser: admin
        adminPassword: admin123
        configUser: "admin"
        configPassword: admin123
    namespace: openldap
    dependsOn:
      - ingress-nginx

